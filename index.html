<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Rsl switch by df3xc</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Rsl switch</h1>
      <h2 class="project-tagline">How to - Wie mache ich es</h2>
      <a href="https://github.com/df3xc/rsl_switch" class="btn">View on GitHub</a>
      <a href="https://github.com/df3xc/rsl_switch/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/df3xc/rsl_switch/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="hallo" class="anchor" href="#hallo" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hallo</h1>

<p>Hier möchte ich zeigen wie man einen Conrad RSL Switch mit dem Particle Photon steuert.</p>

<p>Ein Conrad RSL Switch ist ein per Funk gesteuerter 230V Schalter (siehe <a href="http://www.conrad.de">www.conrad.de</a>)</p>

<p>Was mir an der Conrad RSL Serie gefällt, ist die Vielfältigkeit.</p>

<ul>
<li>Es gibt den Handsender aber auch einen Sender der an die Wand geschraubt werden kann.</li>
<li>Es gibt die 230V Steckdose aber auch einen funkgesteuerten Schalter für die Unterputz-Montage.</li>
</ul>

<p>Der gesteuerte Schalter kann von mehr als einer Fernsteuerung gesteuert werden.  </p>

<p>Getestet habe ich folgende RSL typen</p>

<ul>
<li>Ein Handsender mit 3 gesteuerten Steckdosen : Bestell Nummer : 526917 - 62</li>
<li>Die sehr kleinen 2-Phasen Schalter : Bestell Nummer  : 640553 - 62 </li>
</ul>

<h1>
<a id="voraussetzungen" class="anchor" href="#voraussetzungen" aria-hidden="true"><span class="octicon octicon-link"></span></a>Voraussetzungen</h1>

<p>Dieser Artikel setzt voraus, dass Du folgendes beherrscht:</p>

<p>PARTICLE APP auf Deinem Smartphone installieren.
Mit TINKER die blaue LED and D7 ein- und ausschalten</p>

<p>BLYNK APP auf Deinem Smartphone installieren.
Mit der PARTICLE WEB IDE und der BLYNK Library die blaue LED and D7 ein- und ausschalten.</p>

<h1>
<a id="particle-web-ide" class="anchor" href="#particle-web-ide" aria-hidden="true"><span class="octicon octicon-link"></span></a>PARTICLE WEB IDE</h1>

<p>In der IDE die Library <strong>RSL_SWITCH</strong> suchen.</p>

<p><img src="http://df3xc.github.io/rsl_switch/pictures/select_library.PNG" alt=""></p>

<p>Dann <strong>USE THIS EXAMPLE</strong> auswählen</p>

<p>Ergebnis : Ein neue APP mit dem Namen <strong>conrad-rsl-example.ino</strong> wird erstellt.</p>

<p>In der IDE die Library <strong>BLYNK</strong> suchen.</p>

<p>Dann <strong>INCLUDE IN APP</strong> auswählen</p>

<p>Ergebnis: </p>

<p><img src="http://df3xc.github.io/rsl_switch/pictures/application_and_libraries.PNG" alt=""></p>

<h1>
<a id="hardware-option-1" class="anchor" href="#hardware-option-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hardware Option 1</h1>

<p><img src="http://df3xc.github.io/rsl_switch/pictures/transmitter.PNG" alt=""></p>

<p>Folgende Verbindungen zwischen dem Particle Photon und dem AM Transmitter herstellen</p>

<ul>
<li>ATAD and Photon pin D1</li>
<li>GND an Photon pin GND</li>
<li>VCC an Photon pin VIN</li>
</ul>

<p><img src="http://df3xc.github.io/rsl_switch/pictures/breadboard.PNG" alt=""></p>

<h1>
<a id="hardware-option-2-ein-besserer-am-433-mhz-transmitter" class="anchor" href="#hardware-option-2-ein-besserer-am-433-mhz-transmitter" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hardware Option 2 Ein besserer AM 433 MHz Transmitter</h1>

<p>Ich habe den AM Transmitter der Firma Aurel , Modell TX-SAW MID/5 V AM Sendemodule 433,92 MHz Baustein getestet.</p>

<p><img src="http://df3xc.github.io/rsl_switch/pictures/aurel.png" alt=""></p>

<p>Der Grund : Dieses Sendemodul besitzt eine EC Konformitätserklärung. Das bedeutet, dass der Hersteller einige Tests durchführen lies und dies auch nachweisen kann.</p>

<p>Es gibt ihn als 3V oder 5V Variante. Die 3V Variante kann auch direkt mit einem Raspberry PI verbunden werden.
Der Sender wurde zusammen mit der EC Konformitätserklärung und dem Datenblatt angeliefert.</p>

<p>Das Datenblatt findet man, wenn man nach AUREL TX-SAW MID sucht.</p>

<p>Als Antenne verwende ich einen 16cm langen Draht in senkrechter Position. Ich konnte eine RSL Funkdose in 15 Meter Entfernung durch 3 Wände schalten.</p>

<p>Conrad Bestell Nummer : 191525 - 62 </p>

<h1>
<a id="code-review" class="anchor" href="#code-review" aria-hidden="true"><span class="octicon octicon-link"></span></a>CODE review</h1>

<p>Ich stelle hier nur die Funktionen vor, die Du kennen musst. Der ganze Code ist bewusst einfach gehalten und in der Programmiersprache C implementiert.</p>

<p>Der pin ATAD wird in rsl_switch.cpp bestimmt.</p>

<pre><code>// mit diesem Pin wird der sender gesteuert.
// this pin is used to control the RF transmitter

int dpin = D1;
</code></pre>

<p>Beim starten des Programms muss conrad_rsl_init() aufgerufen werden:</p>

<pre><code>void conrad_rsl_init()
{
   pinMode(dpin,OUTPUT);
   digitalWrite(dpin,LOW);
   delay(500);
}
</code></pre>

<p>Der CODE zum steuern einer Funk Dose, hier ein Beispiel:</p>

<p>"00001110011001001011010000000000" ist ein Code den eine RSL Fernsteuerung sendet.
Die Anführungsstriche bedeuten, dass es sich um eine Zeichenfolge handelt und nicht um ein Zahl.</p>

<p>Der CODE wird in der Funktion conrad_rsl_switch() verwendet.</p>

<pre><code> void conrad_rsl_switch ( int which, int state )
 {
 char es[34];  // code als Zeichenfolge
 memset(es,0,34);

 switch (which) {
  case 1: //  schalter nummer 1 
    if (state==EIN)  strncpy(es,"00001110011001001011010000000000",32);
    if (state==AUS)  strncpy(es,"00000001011001001011010000000000",32);
    break;

  --- snip ---

  case 5: // schalter nummer 2
    if (state==EIN)  strncpy(es,"00000101000001001100000011010111",32);
    if (state==AUS)  strncpy(es,"00001101000001001100000011010111",32);
    break;

  default: 
    Serial.print(" Fehler : konnte Code nicht finden ");
  break;
}

Serial.print("Sende Code : ");
Serial.println(es);
conrad_rsl_send(es,430,1150);
}
</code></pre>

<p>Alternativ kann der Code auch als Dezimal-Zahl angegeben werden:</p>

<pre><code> void conrad_rsl_switch_code ( int which, int state )
 {
 unsigned long code = 0;

 switch (which) { 

 case 1: // schalter 1
    if (state==EIN) code = 241480704; 
    if (state==AUS) code = 23376896; 
    break;

 case 2: // schalter 2
    if (state==EIN) code = 322066944;
    if (state==AUS) code = 778351616; 
    break;

  --- snip ---      

  default: 
    Serial.print(" Fehler : konnte Code nicht finden ");
    break; 
 }

 if (code != 0)
 {
   Serial.print("Sende Code : ");
   Serial.println(code);
   conrad_rsl_send(code,430,1150);
  } 
  else
  {
    Serial.print(" Fehler : konnte Code nicht finden ");      
  }
}
</code></pre>

<p>Ein Beispiel für die Funktion wenn Button 1 gedrückt wurde:</p>

<pre><code>// Verbinde auf der BLYNC APP den Button mit Virtual pin 1
BLYNK_WRITE(V1)
{
    if (param.asInt() == 1) // Schalter nieder gedrückt ?
    {
      println(" rsl dose 1 ein ");
      conrad_rsl_switch(DOSE1,1);
      Blynk.virtualWrite(V11,255);  // V11 ist eine BLYNC APP LED
    }
}
</code></pre>

<h1>
<a id="blync-app-auf-dem-smartphone" class="anchor" href="#blync-app-auf-dem-smartphone" aria-hidden="true"><span class="octicon octicon-link"></span></a>BLYNC APP auf dem Smartphone</h1>

<p>Buttons hinzufügen und mit den virtuellen Pins verbinden.</p>

<p>LEDs hinzufügen und mit den virtuellen Pins verbinden.</p>

<p><img src="http://df3xc.github.io/rsl_switch/pictures/blynk.PNG" alt=""></p>

<h1>
<a id="codes-aufzeichnen" class="anchor" href="#codes-aufzeichnen" aria-hidden="true"><span class="octicon octicon-link"></span></a>Codes aufzeichnen</h1>

<p>Im Auslieferungszustand besitzen die Funk Dosen noch keine Code Sequenz, mit denen sie geschaltet werden. Sie lernen den Code indem man sie mit der Fernsteuerung anlernt. 
Nachdem die Funk Dose die Code Sequenz der Fernsteuerung gelernt hat, müssen wir die Code Sequenz in der Datei rsl_switch.cpp eintragen.</p>

<p>Die Code Sequenz erhalten wir, wenn wir die Fernsteuerung mit dem AM 433 MHz Empfänger abhören.</p>

<h1>
<a id="software" class="anchor" href="#software" aria-hidden="true"><span class="octicon octicon-link"></span></a>Software</h1>

<p>In der Particle IDE die Library <strong>RCSWITCH</strong> suchen.</p>

<p>Die Datei <strong>RECEIVEDEMO_ADVANCED.INO</strong> auswählen</p>

<p><strong>USE THIS EXAMPLE</strong> anklicken</p>

<p>Ergebnis : Eine APP mit dem Namen <strong>RECEIVEDDEMO_ADVANCED</strong> wird erstellt.</p>

<h1>
<a id="hardware" class="anchor" href="#hardware" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hardware</h1>

<p><img src="http://df3xc.github.io/rsl_switch/pictures/receiver.PNG" alt=""></p>

<p>Folgende Verbindungen zwischen dem AM433MHz Empfänger und dem Particle Photon herstellen:</p>

<ul>
<li>DATA an Photon pin D3</li>
<li>GND an Photon pin GND</li>
<li>VCC and Photon pin VIN</li>
<li>USB des Photons mit einem USB Anschluss am Computer verbinden. Dadurch erhält man Zugang zur seriellen Schnittstelle des Photons.</li>
</ul>

<h1>
<a id="codes-aufzeichnen-1" class="anchor" href="#codes-aufzeichnen-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Codes aufzeichnen</h1>

<p>Das Programm auf den Photon flashen.</p>

<p>Ein Terminal Program mit der seriellen Schnittstelle des Photon verbinden.</p>

<p>Auf der Fernbedienung einen Taster drücken. Auf der Terminal wird der Code angezeigt.</p>

<p>Diesen Code in die Datei rsl_switch.cpp übertragen.</p>

<p><img src="http://df3xc.github.io/rsl_switch/pictures/TeratermCode.PNG" alt=""></p>

<h1>
<a id="weiterführende-literatur" class="anchor" href="#weiterf%C3%BChrende-literatur" aria-hidden="true"><span class="octicon octicon-link"></span></a>Weiterführende Literatur</h1>

<p>Nun hast DU eine Art Funkanlage selber gebaut. </p>

<ul>
<li>Darfst Du (die Person) diese Funkanlage betreiben: Hast Du eine Lizenz?</li>
<li>Darf die Funkanlage (das Gerät) betrieben werden : Hat das Gerät eine Zulassung?</li>
</ul>

<p>So manch ein Motorradfahrer scheitert ja kläglich, wenn es an sein Eisenpferd ein Auspuff ohne ABE montiert, nicht wahr ?</p>

<p>Daher mal als Einführung: 
<a href="http://www.bundesnetzagentur.de/SharedDocs/Downloads/DE/Sachgebiete/Telekommunikation/Unternehmen_Institutionen/Frequenzen/Allgemeinzuteilungen/2014_69_SRD_pdf.pdf?__blob=publicationFile&amp;v=1">SRD Funkanalagen</a></p>

<p>Soweit ich das verstehe : </p>

<ul>
<li>Der Einsatz einer Richtantenne ist nicht erlaubt. Das würde dazu führen, das ERP überschritten wird.</li>
<li>Eine andauernde Sendung durch die SW ist nicht erwünscht, weil es alle anderen Geräte - auch die der lieben Nachbarn - stören kann. Die Geräte benutzen ja alle die gleiche Frequenz.</li>
</ul>

<h1>
<a id="moment-mal-" class="anchor" href="#moment-mal-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Moment mal !</h1>

<p>Ganz oben schrieb ich : Der gesteuerte Schalter kann von mehr als einer Fernsteuerung gesteuert werden.  </p>

<p>Wenn Du bereits gültige Codes besitzt, kannst Du die gesteuerten Schalter anlernen,</p>

<p>Dann kannst Du auf den Abschnitt "Codes aufzeichnen" auch verzichten.</p>

<p>Paare deine Schalter mit Deinem Handsender und paare sie mit den Codes des Programms.</p>

<h1>
<a id="viel-spaß" class="anchor" href="#viel-spa%C3%9F" aria-hidden="true"><span class="octicon octicon-link"></span></a>Viel Spaß</h1>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/df3xc/rsl_switch">Rsl switch</a> is maintained by <a href="https://github.com/df3xc">df3xc</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
